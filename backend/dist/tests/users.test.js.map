{"version":3,"sources":["../../src/tests/users.test.ts"],"sourcesContent":["import bcrypt from 'bcrypt';\r\nimport mongoose from 'mongoose';\r\nimport request from 'supertest';\r\nimport App from '@/app';\r\nimport { CreateUserDto } from '@dtos/users.dto';\r\nimport UsersRoute from '@routes/users.route';\r\n\r\nafterAll(async () => {\r\n  await new Promise<void>(resolve => setTimeout(() => resolve(), 500));\r\n});\r\n\r\ndescribe('Testing Users', () => {\r\n  describe('[GET] /users', () => {\r\n    it('response fineAll Users', async () => {\r\n      const usersRoute = new UsersRoute();\r\n      const users = usersRoute.usersController.userService.users;\r\n\r\n      users.find = jest.fn().mockReturnValue([\r\n        {\r\n          _id: 'qpwoeiruty',\r\n          email: 'a@email.com',\r\n          password: await bcrypt.hash('q1w2e3r4!', 10),\r\n        },\r\n        {\r\n          _id: 'alskdjfhg',\r\n          email: 'b@email.com',\r\n          password: await bcrypt.hash('a1s2d3f4!', 10),\r\n        },\r\n        {\r\n          _id: 'zmxncbv',\r\n          email: 'c@email.com',\r\n          password: await bcrypt.hash('z1x2c3v4!', 10),\r\n        },\r\n      ]);\r\n\r\n      (mongoose as any).connect = jest.fn();\r\n      const app = new App([usersRoute]);\r\n      return request(app.getServer()).get(`${usersRoute.path}`).expect(200);\r\n    });\r\n  });\r\n\r\n  describe('[GET] /users/:id', () => {\r\n    it('response findOne User', async () => {\r\n      const userId = 'qpwoeiruty';\r\n\r\n      const usersRoute = new UsersRoute();\r\n      const users = usersRoute.usersController.userService.users;\r\n\r\n      users.findOne = jest.fn().mockReturnValue({\r\n        _id: 'qpwoeiruty',\r\n        email: 'a@email.com',\r\n        password: await bcrypt.hash('q1w2e3r4!', 10),\r\n      });\r\n\r\n      (mongoose as any).connect = jest.fn();\r\n      const app = new App([usersRoute]);\r\n      return request(app.getServer()).get(`${usersRoute.path}/${userId}`).expect(200);\r\n    });\r\n  });\r\n\r\n  describe('[POST] /users', () => {\r\n    it('response Create User', async () => {\r\n      const userData: CreateUserDto = {\r\n        email: 'test@email.com',\r\n        password: 'q1w2e3r4',\r\n      };\r\n\r\n      const usersRoute = new UsersRoute();\r\n      const users = usersRoute.usersController.userService.users;\r\n\r\n      users.findOne = jest.fn().mockReturnValue(null);\r\n      users.create = jest.fn().mockReturnValue({\r\n        _id: '60706478aad6c9ad19a31c84',\r\n        email: userData.email,\r\n        password: await bcrypt.hash(userData.password, 10),\r\n      });\r\n\r\n      (mongoose as any).connect = jest.fn();\r\n      const app = new App([usersRoute]);\r\n      return request(app.getServer()).post(`${usersRoute.path}`).send(userData).expect(201);\r\n    });\r\n  });\r\n\r\n  describe('[PUT] /users/:id', () => {\r\n    it('response Update User', async () => {\r\n      const userId = '60706478aad6c9ad19a31c84';\r\n      const userData: CreateUserDto = {\r\n        email: 'test@email.com',\r\n        password: 'q1w2e3r4',\r\n      };\r\n\r\n      const usersRoute = new UsersRoute();\r\n      const users = usersRoute.usersController.userService.users;\r\n\r\n      if (userData.email) {\r\n        users.findOne = jest.fn().mockReturnValue({\r\n          _id: userId,\r\n          email: userData.email,\r\n          password: await bcrypt.hash(userData.password, 10),\r\n        });\r\n      }\r\n\r\n      users.findByIdAndUpdate = jest.fn().mockReturnValue({\r\n        _id: userId,\r\n        email: userData.email,\r\n        password: await bcrypt.hash(userData.password, 10),\r\n      });\r\n\r\n      (mongoose as any).connect = jest.fn();\r\n      const app = new App([usersRoute]);\r\n      return request(app.getServer()).put(`${usersRoute.path}/${userId}`).send(userData);\r\n    });\r\n  });\r\n\r\n  describe('[DELETE] /users/:id', () => {\r\n    it('response Delete User', async () => {\r\n      const userId = '60706478aad6c9ad19a31c84';\r\n\r\n      const usersRoute = new UsersRoute();\r\n      const users = usersRoute.usersController.userService.users;\r\n\r\n      users.findByIdAndDelete = jest.fn().mockReturnValue({\r\n        _id: '60706478aad6c9ad19a31c84',\r\n        email: 'test@email.com',\r\n        password: await bcrypt.hash('q1w2e3r4!', 10),\r\n      });\r\n\r\n      (mongoose as any).connect = jest.fn();\r\n      const app = new App([usersRoute]);\r\n      return request(app.getServer()).delete(`${usersRoute.path}/${userId}`).expect(200);\r\n    });\r\n  });\r\n});\r\n"],"names":["bcrypt","mongoose","request","App","UsersRoute","afterAll","Promise","resolve","setTimeout","describe","it","usersRoute","users","app","usersController","userService","jest","fn","mockReturnValue","_id","email","hash","password","find","connect","getServer","get","path","expect","userId","findOne","userData","create","post","send","findByIdAndUpdate","put","findByIdAndDelete","delete"],"mappings":"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"}